<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DIPBL Project Organizer · Dante Theme</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --inferno-dark: #12090a;   /* very dark wine */
      --inferno-red:  #8b0d11;   /* deep crimson */
      --inferno-ember:#c43e2f;   /* ember red */
      --inferno-gold: #c8a45d;   /* parchment gold */
      --inferno-ash:  #2a2223;   /* charcoal ash */
      --parchment:    #faf6ef;
    }
    html, body { background: radial-gradient(1000px 500px at 50% 0%, #1f0e10, var(--inferno-dark)); }
    .hdr {
      background:
        radial-gradient(1200px 400px at 50% -20%, rgba(255,90,0,.15), transparent 60%),
        linear-gradient(to right, var(--inferno-dark), #2a0b0b, var(--inferno-red));
    }
    .title-shadow { text-shadow: 0 2px 10px rgba(0,0,0,.6); }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255,255,255,.08);
    }
    .parchment {
      background: linear-gradient(180deg, rgba(200,164,93,.08), rgba(200,164,93,.04));
      border: 1px solid rgba(200,164,93,.22);
    }
    .flame-divider {
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--inferno-ember), var(--inferno-gold), var(--inferno-ember), transparent);
      filter: drop-shadow(0 0 6px rgba(196,62,47,.45));
    }
    .chart-slim { position: relative; height: 8rem; }    /* compact charts */
    @media (min-width: 768px) { .chart-slim { height: 10rem; } }

    .hat { border-width:1px; }
    .hat-white { background:#f7f7f7; color:#111; border-color:#e5e5e5; }
    .hat-red   { background:#7f1d1d; color:#fff; border-color:#9f1239; }
    .hat-black { background:#0b0b0c; color:#e5e7eb; border-color:#1f2937; }
    .hat-yellow{ background:#f6e27a; color:#111; border-color:#eab308; }
    .hat-green { background:#064e3b; color:#d1fae5; border-color:#059669; }
    .hat-blue  { background:#0f172a; color:#e2e8f0; border-color:#334155; }

    textarea {
      resize: vertical;
      min-height: 6rem;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.2);
    }
    .count { font-variant-numeric: tabular-nums; }
  </style>
</head>
<body class="text-gray-100 font-[Crimson_Text] min-h-full">

  <!-- Header -->
  <header class="hdr text-center py-10 shadow-xl">
    <h1 class="font-[Cinzel] text-3xl md:text-5xl font-extrabold text-[var(--inferno-gold)] title-shadow">
      DIPBL Project Organizer
    </h1>
    <p class="mt-2 text-sm md:text-base text-gray-200/90">Track time, think with De Bono’s hats, and analyze through Dante, Contemporary Art, and Community Action lenses.</p>
    <div class="mx-auto mt-6 max-w-5xl flame-divider rounded-full"></div>
  </header>

  <main class="max-w-6xl mx-auto px-4 md:px-6 py-8 space-y-8">

    <!-- TOP STRIP: Compact Charts -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Time Allocation -->
      <div class="card rounded-2xl p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-[Cinzel] text-lg text-[var(--inferno-gold)]">Time Allocation</h2>
          <button id="timeExport" class="text-xs px-2 py-1 rounded bg-[var(--inferno-ash)] hover:bg-black/60">PNG</button>
        </div>
        <div class="chart-slim"><canvas id="timeChart"></canvas></div>
        <details class="mt-2">
          <summary class="cursor-pointer text-xs text-gray-300 hover:text-white">Adjust data</summary>
          <div class="grid grid-cols-2 gap-2 mt-2 text-xs">
            <label>Design <input id="t-design" type="number" min="0" max="20" value="3" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
            <label>Calibrate <input id="t-cal" type="number" min="0" max="20" value="3" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
            <label>Co-Manage <input id="t-co" type="number" min="0" max="20" value="3" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
            <label>Debrief <input id="t-deb" type="number" min="0" max="20" value="1" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
          </div>
        </details>
      </div>

      <!-- Tasks -->
      <div class="card rounded-2xl p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-[Cinzel] text-lg text-[var(--inferno-gold)]">Task Distribution</h2>
          <button id="taskExport" class="text-xs px-2 py-1 rounded bg-[var(--inferno-ash)] hover:bg-black/60">PNG</button>
        </div>
        <div class="chart-slim"><canvas id="taskChart"></canvas></div>
        <details class="mt-2">
          <summary class="cursor-pointer text-xs text-gray-300 hover:text-white">Adjust data</summary>
          <div class="grid grid-cols-2 gap-2 mt-2 text-xs">
            <label>Research <input id="k-research" type="number" min="0" value="6" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
            <label>Build <input id="k-build" type="number" min="0" value="10" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
            <label>Test <input id="k-test" type="number" min="0" value="5" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
            <label>Present <input id="k-present" type="number" min="0" value="3" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
          </div>
        </details>
      </div>

      <!-- Resources -->
      <div class="card rounded-2xl p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-[Cinzel] text-lg text-[var(--inferno-gold)]">Resources (hours)</h2>
          <button id="resExport" class="text-xs px-2 py-1 rounded bg-[var(--inferno-ash)] hover:bg-black/60">PNG</button>
        </div>
        <div class="chart-slim"><canvas id="resChart"></canvas></div>
        <details class="mt-2">
          <summary class="cursor-pointer text-xs text-gray-300 hover:text-white">Adjust data</summary>
          <div class="grid grid-cols-2 gap-2 mt-2 text-xs">
            <label>Mentor <input id="r-mentor" type="number" min="0" step="0.5" value="4" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
            <label>Lab/Tools <input id="r-lab" type="number" min="0" step="0.5" value="6" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
            <label>Reading <input id="r-reading" type="number" min="0" step="0.5" value="3" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
            <label>Practice <input id="r-practice" type="number" min="0" step="0.5" value="5" class="w-full rounded px-2 py-1 bg-black/30 border border-white/10"></label>
          </div>
        </details>
      </div>
    </section>

    <!-- Six Thinking Hats -->
    <section class="parchment rounded-2xl p-6">
      <div class="flex items-center gap-3 mb-4">
        <svg width="22" height="22" viewBox="0 0 24 24" class="shrink-0"><path fill="currentColor" d="M12 2c-3 0-5 2-5 4v1H6a2 2 0 0 0-2 2v1h16V9a2 2 0 0 0-2-2h-1V6c0-2-2-4-5-4m-7 9v6a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3v-6z"/></svg>
        <h2 class="font-[Cinzel] text-2xl text-[var(--inferno-red)]">Six Thinking Hats</h2>
      </div>
      <p class="text-sm text-gray-900/80 mb-4">Use each hat to explore your idea from different angles. Notes auto-save locally.</p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="hat hat-white rounded-xl p-4">
          <h3 class="font-[Cinzel] text-lg mb-2">White — Facts</h3>
          <textarea id="hat-white" placeholder="Key facts, data, sources…"
            class="w-full rounded p-3 text-sm text-gray-900"></textarea>
          <div class="flex justify-between mt-2 text-xs">
            <span>What do we know? What’s missing?</span><span class="count" data-for="hat-white"></span>
          </div>
        </div>

        <div class="hat hat-red rounded-xl p-4">
          <h3 class="font-[Cinzel] text-lg mb-2">Red — Feelings</h3>
          <textarea id="hat-red" placeholder="Intuition, gut reactions, emotions…"
            class="w-full rounded p-3 text-sm text-white/90"></textarea>
          <div class="flex justify-between mt-2 text-xs">
            <span>How does this feel?</span><span class="count" data-for="hat-red"></span>
          </div>
        </div>

        <div class="hat hat-black rounded-xl p-4">
          <h3 class="font-[Cinzel] text-lg mb-2">Black — Cautions</h3>
          <textarea id="hat-black" placeholder="Risks, weaknesses, concerns…"
            class="w-full rounded p-3 text-sm text-gray-100"></textarea>
          <div class="flex justify-between mt-2 text-xs">
            <span>What could go wrong?</span><span class="count" data-for="hat-black"></span>
          </div>
        </div>

        <div class="hat hat-yellow rounded-xl p-4">
          <h3 class="font-[Cinzel] text-lg mb-2">Yellow — Benefits</h3>
          <textarea id="hat-yellow" placeholder="Benefits, value, opportunities…"
            class="w-full rounded p-3 text-sm text-gray-900"></textarea>
          <div class="flex justify-between mt-2 text-xs">
            <span>Why is this worthwhile?</span><span class="count" data-for="hat-yellow"></span>
          </div>
        </div>

        <div class="hat hat-green rounded-xl p-4">
          <h3 class="font-[Cinzel] text-lg mb-2">Green — Ideas</h3>
          <textarea id="hat-green" placeholder="Alternatives, creative angles, variations…"
            class="w-full rounded p-3 text-sm text-emerald-50"></textarea>
          <div class="flex justify-between mt-2 text-xs">
            <span>What else could we try?</span><span class="count" data-for="hat-green"></span>
          </div>
        </div>

        <div class="hat hat-blue rounded-xl p-4">
          <h3 class="font-[Cinzel] text-lg mb-2">Blue — Process</h3>
          <textarea id="hat-blue" placeholder="Next steps, process, roles, timeline…"
            class="w-full rounded p-3 text-sm text-slate-100"></textarea>
          <div class="flex justify-between mt-2 text-xs">
            <span>How do we manage it?</span><span class="count" data-for="hat-blue"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Three-Lens Analysis -->
    <section class="card rounded-2xl p-6">
      <div class="flex items-center gap-3 mb-4">
        <svg width="22" height="22" viewBox="0 0 24 24" class="shrink-0"><path fill="currentColor" d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm1 15h-2v-2h2Zm0-4h-2V7h2Z"/></svg>
        <h2 class="font-[Cinzel] text-2xl text-[var(--inferno-gold)]">Three-Lens Analysis</h2>
      </div>
      <p class="text-sm text-gray-200/90 mb-4">Brainstorm for each lens. Use prompts to get started.</p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Dante -->
        <div class="rounded-xl p-4 border border-white/10 bg-black/20">
          <h3 class="font-[Cinzel] text-lg text-[var(--inferno-ember)]">Dante’s Lens</h3>
          <p class="text-xs text-gray-300 mb-2">Allegory, moral choices, symbolism, journey motifs, circles/sins/virtues.</p>
          <textarea id="lens-dante" placeholder="How does your topic echo Dante’s journeys or moral frameworks?"
            class="w-full rounded p-3 text-sm"></textarea>
          <div class="flex justify-between mt-2 text-xs">
            <span>Prompt: Which circle/theme best mirrors your issue?</span><span class="count" data-for="lens-dante"></span>
          </div>
        </div>

        <!-- Contemporary Art -->
        <div class="rounded-xl p-4 border border-white/10 bg-black/20">
          <h3 class="font-[Cinzel] text-lg text-[var(--inferno-ember)]">Contemporary Art’s Lens</h3>
          <p class="text-xs text-gray-300 mb-2">Media, audience, message, intervention, remix, visual metaphors.</p>
          <textarea id="lens-art" placeholder="How might contemporary artists represent or challenge this topic?"
            class="w-full rounded p-3 text-sm"></textarea>
          <div class="flex justify-between mt-2 text-xs">
            <span>Prompt: What form would your ‘piece’ take?</span><span class="count" data-for="lens-art"></span>
          </div>
        </div>

        <!-- Community Action -->
        <div class="rounded-xl p-4 border border-white/10 bg-black/20">
          <h3 class="font-[Cinzel] text-lg text-[var(--inferno-ember)]">Community Action’s Lens</h3>
          <p class="text-xs text-gray-300 mb-2">Stakeholders, needs, feasibility, impact, ethical considerations.</p>
          <textarea id="lens-community" placeholder="What actions could mobilize your community around this topic?"
            class="w-full rounded p-3 text-sm"></textarea>
          <div class="flex justify-between mt-2 text-xs">
            <span>Prompt: What is a first, concrete step?</span><span class="count" data-for="lens-community"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Actions -->
    <section class="flex flex-wrap items-center gap-3 justify-between">
      <div class="text-xs text-gray-300">No personal data is collected. All entries stay in your browser.</div>
      <div class="flex gap-2">
        <button id="exportNotes" class="px-3 py-2 rounded bg-[var(--inferno-ember)] text-white hover:brightness-110">Download Notes (.txt)</button>
        <button id="clearAll" class="px-3 py-2 rounded bg-black/40 hover:bg-black/60 border border-white/10">Clear Saved Data</button>
      </div>
    </section>

  </main>

  <footer class="text-center text-[11px] text-gray-400 py-6">
    © DIPBL Organizer. Theme inspired by <span class="text-[var(--inferno-gold)]">Dante’s Inferno</span>.
  </footer>

  <script>
    /* =========================
       Core Utilities & Storage
       ========================= */
    const PREFIX = 'dipbl_v2_';
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const save = (k, v) => { try { localStorage.setItem(PREFIX + k, v); } catch(e){} };
    const load = (k, d='') => { try { return localStorage.getItem(PREFIX + k) ?? d; } catch(e){ return d; } };
    const saveJSON = (k, obj) => save(k, JSON.stringify(obj));
    const loadJSON = (k, d=[]) => { try { const v = JSON.parse(load(k)); return Array.isArray(v) ? v : d; } catch(e){ return d; } };
    const toInt = (v, min=0) => { v = parseFloat(v); return isNaN(v) ? min : Math.max(min, v); };

    /* =========================
       Charts (compact strip)
       ========================= */
    // Load or defaults
    const timeVals = loadJSON('time', [3,3,3,1]);
    const taskVals = loadJSON('tasks', [6,10,5,3]);
    const resVals  = loadJSON('res',  [4,6,3,5]);

    // Build charts
    const timeChart = new Chart($('#timeChart').getContext('2d'), {
      type: 'bar',
      data: { labels: ['Design','Calibrate','Co-Manage','Debrief'],
        datasets: [{ label:'Weeks', data: timeVals, borderWidth:1 }] },
      options: { responsive:true, maintainAspectRatio:false,
        scales:{ y:{ beginAtZero:true, ticks:{ precision:0 } } },
        plugins:{ legend:{ display:false } } }
    });

    const taskChart = new Chart($('#taskChart').getContext('2d'), {
      type: 'doughnut',
      data: { labels: ['Research','Build','Test','Present'],
        datasets: [{ label:'Tasks', data: taskVals }] },
      options: { responsive:true, maintainAspectRatio:false,
        plugins:{ legend:{ position:'bottom', labels:{ color:'#e5e7eb' } } } }
    });

    const resChart = new Chart($('#resChart').getContext('2d'), {
      type: 'line',
      data: { labels: ['Mentor','Lab/Tools','Reading','Practice'],
        datasets: [{ label:'Hours', data: resVals, tension:0.25, fill:false }] },
      options: { responsive:true, maintainAspectRatio:false,
        scales:{ y:{ beginAtZero:true } },
        plugins:{ legend:{ display:false } } }
    });

    // Inputs -> charts -> storage
    const bindNumInput = (id, arr, idx, chart, key) => {
      const el = $(id);
      if (!el) return;
      el.value = arr[idx];
      el.addEventListener('input', () => {
        arr[idx] = toInt(el.value, 0);
        chart.data.datasets[0].data = arr;
        chart.update();
        saveJSON(key, arr);
      });
    };

    bindNumInput('#t-design', timeVals, 0, timeChart, 'time');
    bindNumInput('#t-cal',    timeVals, 1, timeChart, 'time');
    bindNumInput('#t-co',     timeVals, 2, timeChart, 'time');
    bindNumInput('#t-deb',    timeVals, 3, timeChart, 'time');

    bindNumInput('#k-research', taskVals, 0, taskChart, 'tasks');
    bindNumInput('#k-build',    taskVals, 1, taskChart, 'tasks');
    bindNumInput('#k-test',     taskVals, 2, taskChart, 'tasks');
    bindNumInput('#k-present',  taskVals, 3, taskChart, 'tasks');

    bindNumInput('#r-mentor',   resVals, 0, resChart, 'res');
    bindNumInput('#r-lab',      resVals, 1, resChart, 'res');
    bindNumInput('#r-reading',  resVals, 2, resChart, 'res');
    bindNumInput('#r-practice', resVals, 3, resChart, 'res');

    // PNG export
    const toPNG = (chart, filename) => {
      const url = chart.toBase64Image ? chart.toBase64Image() : chart.canvas.toDataURL('image/png');
      const a = document.createElement('a'); a.href = url; a.download = filename; a.click();
    };
    $('#timeExport').addEventListener('click', ()=>toPNG(timeChart,'time-allocation.png'));
    $('#taskExport').addEventListener('click', ()=>toPNG(taskChart,'task-distribution.png'));
    $('#resExport').addEventListener('click',  ()=>toPNG(resChart,'resources-hours.png'));

    /* =========================
       Notes (Hats + Lenses)
       ========================= */
    const textAreas = [
      'hat-white','hat-red','hat-black','hat-yellow','hat-green','hat-blue',
      'lens-dante','lens-art','lens-community'
    ];

    // Initialize values and counters
    const wordCount = s => (s.trim().length ? s.trim().split(/\s+/).length : 0);

    textAreas.forEach(id => {
      const el = $('#'+id);
      const saved = load(id, '');
      if (saved) el.value = saved;
      const counter = document.querySelector(`.count[data-for="${id}"]`);
      const updateCount = () => { if (counter) counter.textContent = `${wordCount(el.value)} words`; };
      updateCount();

      let t = null;
      el.addEventListener('input', () => {
        clearTimeout(t);
        t = setTimeout(() => {
          save(id, el.value);
          updateCount();
        }, 200); // debounce for smoother typing
      });
    });

    /* =========================
       Export / Clear
       ========================= */
    $('#exportNotes').addEventListener('click', () => {
      const lines = [];
      const push = (h, id) => {
        const val = load(id, '');
        lines.push(`\n=== ${h} ===\n${val || ''}`);
      };

      push('Six Hats · White (Facts)', 'hat-white');
      push('Six Hats · Red (Feelings)', 'hat-red');
      push('Six Hats · Black (Cautions)', 'hat-black');
      push('Six Hats · Yellow (Benefits)', 'hat-yellow');
      push('Six Hats · Green (Ideas)', 'hat-green');
      push('Six Hats · Blue (Process)', 'hat-blue');

      push('Lens · Dante', 'lens-dante');
      push('Lens · Contemporary Art', 'lens-art');
      push('Lens · Community Action', 'lens-community');

      const blob = new Blob([lines.join('\n')], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'dipbl_notes.txt'; a.click();
      URL.revokeObjectURL(url);
    });

    $('#clearAll').addEventListener('click', () => {
      if (!confirm('Clear all saved data for this page on this device?')) return;
      const keys = [];
      for (let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if (k && k.startsWith(PREFIX)) keys.push(k);
      }
      keys.forEach(k => localStorage.removeItem(k));
      location.reload();
    });
  </script>
</body>
</html>
